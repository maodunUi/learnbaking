<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ymt.dao.DetailDao">

<sql id="Simple_Column">
 select
 detail.id as detail_id,
 detail.img_url as detail_img_url,
 detail.title as detail_title,
 detail.memo as detail_memo,
 detail.tips as detail_tips,
 detail.add_time as detail_add_time,
 detail.state as detail_state,
 detail.order_index as detail_order_index,
 detail.userid as detail_userid,
 detail.introduce as detail_introduce,
 detail.materials as detail_materials,
 detail.step as detail_step
 from detail as detail 
</sql>

<sql id="Base_Column">
 select
 detail.id as detail_id,
 detail.img_url as detail_img_url,
 detail.title as detail_title,
 detail.memo as detail_memo,
 detail.tips as detail_tips,
 detail.add_time as detail_add_time,
 detail.state as detail_state,
 detail.order_index as detail_order_index,
 detail.userid as detail_userid,
 detail.introduce as detail_introduce,
 detail.materials as detail_materials,
 detail.step as detail_step
 from detail as detail 
</sql>

<sql id="Detail_Column">
 select
 detail.id as detail_id,
 detail.img_url as detail_img_url,
 detail.title as detail_title,
 detail.memo as detail_memo,
 detail.tips as detail_tips,
 detail.add_time as detail_add_time,
 detail.state as detail_state,
 detail.order_index as detail_order_index,
 detail.userid as detail_userid,
 detail.introduce as detail_introduce,
 detail.materials as detail_materials,
 detail.step as detail_step
 from detail as detail 
</sql>

<resultMap id="SimpleResultMap" type="cn.ymt.view.simple.DetailSimpleView">
<id column="detail_id" jdbcType="INTEGER" property="id" />
 <result column="detail_img_url" jdbcType="VARCHAR" property="img_url" />
 <result column="detail_title" jdbcType="VARCHAR" property="title" />
 <result column="detail_memo" jdbcType="LONGVARCHAR" property="memo" />
 <result column="detail_tips" jdbcType="VARCHAR" property="tips" />
 <result column="detail_add_time" jdbcType="DATE" property="add_time" />
 <result column="detail_state" jdbcType="TINYINT" property="state" />
 <result column="detail_order_index" jdbcType="TINYINT" property="order_index" />
 <result column="detail_userid" jdbcType="INTEGER" property="userid" />
 <result column="detail_introduce" jdbcType="VARCHAR" property="introduce" />
 <result column="detail_materials" jdbcType="VARCHAR" property="materials" />
 <result column="detail_step" jdbcType="LONGVARCHAR" property="step" />
</resultMap>

<resultMap id="BaseResultMap" type="cn.ymt.view.DetailView">
<id column="detail_id" jdbcType="INTEGER" property="id" />
 <result column="detail_img_url" jdbcType="VARCHAR" property="img_url" />
 <result column="detail_title" jdbcType="VARCHAR" property="title" />
 <result column="detail_memo" jdbcType="LONGVARCHAR" property="memo" />
 <result column="detail_tips" jdbcType="VARCHAR" property="tips" />
 <result column="detail_add_time" jdbcType="DATE" property="add_time" />
 <result column="detail_state" jdbcType="TINYINT" property="state" />
 <result column="detail_order_index" jdbcType="TINYINT" property="order_index" />
 <result column="detail_userid" jdbcType="INTEGER" property="userid" />
 <result column="detail_introduce" jdbcType="VARCHAR" property="introduce" />
 <result column="detail_materials" jdbcType="VARCHAR" property="materials" />
 <result column="detail_step" jdbcType="LONGVARCHAR" property="step" />
</resultMap>

<resultMap id="DetailResultMap" type="cn.ymt.view.DetailView" extends="BaseResultMap">
</resultMap>

<delete id="deleteById" parameterType="java.lang.Integer">
delete from detail where id = #{id,jdbcType=INTEGER}
</delete>

<delete id="deleteByIds">
delete from detail
where <foreach collection="list" item="i" open="(" close=")" separator=" or "> id=#{i,jdbcType=INTEGER} </foreach>
  </delete>

<delete id="deleteObjects">
delete from detail
where <foreach collection="list" item="i" open="(" close=")" separator=" or "> id=#{i.id,jdbcType=INTEGER} </foreach>
  </delete>

<delete id="deleteByParams" parameterType="cn.ymt.query.DetailQueryParams">
delete from detail 
<where><if test="condition != null">${condition}</if></where>
</delete>

<insert id="save" parameterType="cn.ymt.view.DetailView" useGeneratedKeys="true" keyProperty="id">
insert into detail (img_url,title,memo,tips,add_time,state,order_index,userid,introduce,materials,step) 
 values(#{img_url,jdbcType=VARCHAR},#{title,jdbcType=VARCHAR},#{memo,jdbcType=LONGVARCHAR},#{tips,jdbcType=VARCHAR},#{add_time,jdbcType=DATE},#{state,jdbcType=TINYINT},#{order_index,jdbcType=TINYINT},#{userid,jdbcType=INTEGER},#{introduce,jdbcType=VARCHAR},#{materials,jdbcType=VARCHAR},#{step,jdbcType=LONGVARCHAR})
</insert>

<insert id="saveNoNull" parameterType="cn.ymt.view.DetailView" useGeneratedKeys="true" keyProperty="id">
insert into detail
<trim prefix="(" suffix=")" suffixOverrides=",">
 <if test="img_url != null">
img_url,
</if>
 <if test="title != null">
title,
</if>
 <if test="memo != null">
memo,
</if>
 <if test="tips != null">
tips,
</if>
 <if test="add_time != null">
add_time,
</if>
 <if test="state != null">
state,
</if>
 <if test="order_index != null">
order_index,
</if>
 <if test="userid != null">
userid,
</if>
 <if test="introduce != null">
introduce,
</if>
 <if test="materials != null">
materials,
</if>
 <if test="step != null">
step,
</if>
</trim>

<trim prefix="values(" suffix=")" suffixOverrides=",">
<if test="img_url != null">
#{img_url,jdbcType=VARCHAR},
</if>
<if test="title != null">
#{title,jdbcType=VARCHAR},
</if>
<if test="memo != null">
#{memo,jdbcType=LONGVARCHAR},
</if>
<if test="tips != null">
#{tips,jdbcType=VARCHAR},
</if>
<if test="add_time != null">
#{add_time,jdbcType=DATE},
</if>
<if test="state != null">
#{state,jdbcType=TINYINT},
</if>
<if test="order_index != null">
#{order_index,jdbcType=TINYINT},
</if>
<if test="userid != null">
#{userid,jdbcType=INTEGER},
</if>
<if test="introduce != null">
#{introduce,jdbcType=VARCHAR},
</if>
<if test="materials != null">
#{materials,jdbcType=VARCHAR},
</if>
<if test="step != null">
#{step,jdbcType=LONGVARCHAR},
</if>
</trim>
</insert>

<insert id="saves" >
insert into detail (img_url,title,memo,tips,add_time,state,order_index,userid,introduce,materials,step) 
 values <foreach collection="list" item="obj" separator=",">(#{obj.img_url,jdbcType=VARCHAR},#{obj.title,jdbcType=VARCHAR},#{obj.memo,jdbcType=LONGVARCHAR},#{obj.tips,jdbcType=VARCHAR},#{obj.add_time,jdbcType=DATE},#{obj.state,jdbcType=TINYINT},#{obj.order_index,jdbcType=TINYINT},#{obj.userid,jdbcType=INTEGER},#{obj.introduce,jdbcType=VARCHAR},#{obj.materials,jdbcType=VARCHAR},#{obj.step,jdbcType=LONGVARCHAR})</foreach>
</insert>
<update id="updateAll" parameterType="cn.ymt.view.DetailView">
update detail 
set  img_url = #{img_url,jdbcType=VARCHAR}, title = #{title,jdbcType=VARCHAR}, memo = #{memo,jdbcType=LONGVARCHAR}, tips = #{tips,jdbcType=VARCHAR}, add_time = #{add_time,jdbcType=DATE}, state = #{state,jdbcType=TINYINT}, order_index = #{order_index,jdbcType=TINYINT}, userid = #{userid,jdbcType=INTEGER}, introduce = #{introduce,jdbcType=VARCHAR}, materials = #{materials,jdbcType=VARCHAR}, step = #{step,jdbcType=LONGVARCHAR} where id = #{id,jdbcType=INTEGER}
</update>
 <update id="updateNoNull" parameterType="cn.ymt.view.DetailView">
update detail 
<set>
<if test="img_url != null"> img_url = #{img_url,jdbcType=VARCHAR},</if>
<if test="title != null"> title = #{title,jdbcType=VARCHAR},</if>
<if test="memo != null"> memo = #{memo,jdbcType=LONGVARCHAR},</if>
<if test="tips != null"> tips = #{tips,jdbcType=VARCHAR},</if>
<if test="add_time != null"> add_time = #{add_time,jdbcType=DATE},</if>
<if test="state != null"> state = #{state,jdbcType=TINYINT},</if>
<if test="order_index != null"> order_index = #{order_index,jdbcType=TINYINT},</if>
<if test="userid != null"> userid = #{userid,jdbcType=INTEGER},</if>
<if test="introduce != null"> introduce = #{introduce,jdbcType=VARCHAR},</if>
<if test="materials != null"> materials = #{materials,jdbcType=VARCHAR},</if>
<if test="step != null"> step = #{step,jdbcType=LONGVARCHAR},</if>
</set>
 where id = #{id,jdbcType=INTEGER}
</update>

<select id="getBasicById"  resultMap="BaseResultMap" parameterType="java.lang.Integer">
<include refid="Base_Column" />
where detail.id = #{id,jdbcType=INTEGER}
</select>

<select id="getDetailById"  resultMap="DetailResultMap" parameterType="java.lang.Integer">
<include refid="Detail_Column" />
where detail.id = #{id,jdbcType=INTEGER}
</select>

<select id="count" parameterType="cn.ymt.query.DetailQueryParams" resultType="long">
select count(distinct detail.id) from detail as detail
<where>
<if test="condition != null">(${condition})</if>
</where>
</select>

<select id="getDistinctIds" parameterType="cn.ymt.query.DetailQueryParams" resultType="java.lang.Integer">
select distinct detail.id from detail as detail
<where>
<if test="condition != null">(${condition})</if>
</where>
<if test="recordIndex != null"> limit #{recordIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}</if>
</select>

<select id="getSimple" parameterType="cn.ymt.query.DetailQueryParams" resultMap="SimpleResultMap">
<include refid="Simple_Column" />
<where>
<if test="condition != null">(${condition})</if>
<if test="pojos != null">
 and <foreach collection="pojos" open="(" close=")" separator=" or " item="pojo">detail.id=#{pojo.id,jdbcType=INTEGER}</foreach>
</if>
<if test="ids != null">
 and <foreach collection="ids" open="(" close=")" separator=" or " item="idTemp">detail.id=#{idTemp,jdbcType=INTEGER}</foreach>
</if>
</where>
<if test="orderBy != null"> order by ${orderBy}</if>
<if test="recordIndex != null"> limit #{recordIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}</if>
</select>

<select id="getBasic" parameterType="cn.ymt.query.DetailQueryParams" resultMap="BaseResultMap">
<include refid="Base_Column" />
<where>
<if test="condition != null">(${condition})</if>
<if test="pojos != null">
 and <foreach collection="pojos" open="(" close=")" separator=" or " item="pojo">detail.id=#{pojo.id,jdbcType=INTEGER}</foreach>
</if>
<if test="ids != null">
 and <foreach collection="ids" open="(" close=")" separator=" or " item="idTemp">detail.id=#{idTemp,jdbcType=INTEGER}</foreach>
</if>
</where>
<if test="orderBy != null"> order by ${orderBy}</if>
<if test="recordIndex != null"> limit #{recordIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}</if>
</select>

<select id="getDetail" parameterType="cn.ymt.query.DetailQueryParams" resultMap="DetailResultMap">
<include refid="Detail_Column" />
 where detail.id in 
(select * from(select distinct detail.id from detail as detail 
<where>
<if test="condition != null">(${condition})</if>
</where>
<if test="recordIndex != null"> limit #{recordIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}</if>
) as detailtempTable)
</select>
<!--&&&&&&&&&&&&&&&&&&&&&&-->
 <!--得到首页四张轮播图-->
 <select id="getFour" resultMap="SimpleResultMap">
  select * from detail order by add_time desc limit 0,4
 </select>
 <select id="getSix" resultMap="SimpleResultMap">
  select * from detail order by add_time desc limit 4,6
 </select>
</mapper>